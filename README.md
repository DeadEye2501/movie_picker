# Movie Picker

Десктопное приложение для поиска фильмов и сериалов с персонализированными рекомендациями на основе ваших оценок.

## Возможности

- **Поиск** — по названию, актёрам, режиссёрам с фильтрацией по жанрам
- **Рейтинги** — отображение оценок TMDB, IMDB, Rotten Tomatoes и Metacritic
- **Персональные рекомендации** — система учитывает ваши оценки и подбирает фильмы под ваш вкус
- **Волшебная кнопка** — мгновенно находит лучший непросмотренный фильм
- **Похожие фильмы** — поиск похожих на основе рекомендаций TMDB
- **Рецензии** — возможность писать заметки к просмотренным фильмам
- **Тёмная тема** — Material Design интерфейс

## Установка

### Требования

- Python 3.10+
- pipenv

### Шаги

```bash
# Клонировать репозиторий
git clone <repository-url>
cd movie_picker

# Установить зависимости
pipenv install

# Создать .env с API ключами
cp .env.example .env
# Отредактировать .env и вставить свои ключи

# Запустить приложение
pipenv run python main.py
```

## Конфигурация

Создайте файл `.env` в корне проекта (или скопируйте из `.env.example`):

```env
TMDB_API_KEY=ваш_ключ_tmdb
OMDB_API_KEY=ваш_ключ_omdb
```

### Получение API ключей

1. **TMDB** (обязательно):
   - Зарегистрируйтесь на [themoviedb.org](https://www.themoviedb.org/)
   - Перейдите в Settings → API → Create → Developer
   - Скопируйте API Key (v3 auth)

2. **OMDB** (опционально, для рейтингов RT и Metacritic):
   - Получите бесплатный ключ на [omdbapi.com](https://www.omdbapi.com/apikey.aspx)

## Использование

### Поиск фильмов

1. Введите запрос в строку поиска (название, актёр, режиссёр)
2. Опционально выберите жанры (фильтр по AND — все выбранные жанры должны присутствовать)
3. Нажмите кнопку поиска

### Оценка фильмов

Кликните на звёзды (1-10) на карточке фильма. Цвет звёзд меняется от красного (1) до синего (10).

### Волшебная кнопка

Нажмите кнопку со звёздочками справа от поиска — система найдёт лучший непросмотренный фильм на основе ваших предпочтений.

### Похожие фильмы

На карточке фильма нажмите "Найти похожие" для поиска похожих фильмов.

## Как работает система рекомендаций

### Формула персонального рейтинга

Для каждого фильма вычисляется score:

```
score = 1.0 × TMDB_близость +
        0.8 × (рейтинг_режиссёра - 5) +
        0.5 × (средний_рейтинг_жанров - 5) +
        0.3 × (средний_рейтинг_актёров - 5) +
        0.2 × (рейтинг_агрегаторов - 5)
```

### TMDB близость

- Для каждого оценённого фильма (6-10 = понравился, 1-4 = не понравился) система получает рекомендации TMDB
- Если искомый фильм есть в рекомендациях понравившегося — score увеличивается
- Если в рекомендациях не понравившегося — score уменьшается
- Позиция в списке рекомендаций влияет на вес

### Рейтинги сущностей

При каждой оценке пересчитываются средние рейтинги:
- **Жанров** — среднее по всем фильмам этого жанра
- **Режиссёров** — среднее по всем фильмам режиссёра
- **Актёров** — среднее по всем фильмам с участием актёра

### Оптимизации

- Рекомендации TMDB кэшируются в БД на 7 дней
- Параллельные API запросы для ускорения поиска
- Учитываются только топ-15 понравившихся и топ-15 не понравившихся фильмов

## Структура проекта

```
movie_picker/
├── main.py                 # Точка входа
├── .env                    # API ключи (не в git)
├── .env.example            # Шаблон для .env
├── movie_picker.db         # SQLite база данных
│
├── api/
│   ├── __init__.py
│   ├── tmdb.py             # TMDB API клиент
│   └── omdb.py             # OMDB API клиент
│
├── database/
│   ├── __init__.py
│   ├── models.py           # SQLAlchemy модели
│   └── db.py               # Операции с БД
│
├── services/
│   ├── __init__.py
│   ├── search.py           # Сервис поиска
│   └── recommender.py      # Система рекомендаций
│
└── ui/
    ├── __init__.py
    ├── app.py              # Главное окно
    ├── theme.py            # Тёмная тема
    └── components/
        ├── __init__.py
        ├── search_bar.py   # Панель поиска
        ├── movie_list.py   # Список фильмов
        ├── movie_card.py   # Карточка фильма
        └── rating_dialog.py # Диалог рецензии
```

## Модели данных

### Movie
- `kinopoisk_id` — ID в TMDB
- `is_tv` — флаг сериала
- `title`, `title_original` — названия
- `year`, `genres`, `director`, `actors`
- `tmdb_rating`, `imdb_rating`, `rotten_tomatoes`, `metacritic`

### UserRating
- `movie_id` — связь с фильмом
- `rating` — оценка 1-10
- `review` — текст рецензии

### EntityRating
- `entity_type` — тип (genre/director/actor)
- `entity_name` — название
- `avg_rating` — средняя оценка пользователя
- `count` — количество оценённых фильмов

### RecommendationCache
- Кэш рекомендаций TMDB для ускорения работы

## Технологии

- **[Flet](https://flet.dev/)** — UI фреймворк (Material Design)
- **[SQLAlchemy](https://www.sqlalchemy.org/)** — ORM для SQLite
- **[HTTPX](https://www.python-httpx.org/)** — HTTP клиент
- **[TMDB API](https://developers.themoviedb.org/3)** — данные о фильмах
- **[OMDB API](https://www.omdbapi.com/)** — дополнительные рейтинги

## Сборка exe

```bash
# Установить PyInstaller (если не установлен)
pipenv run pip install pyinstaller

# Собрать exe
pipenv run flet pack main.py -n "MoviePicker" --product-name "Movie Picker" --product-version "1.0.0" -y
```

Готовый файл будет в папке `dist/MoviePicker.exe` (~82 MB).

**Важно:** Для работы exe нужен файл `.env` с API ключами в той же папке, где лежит exe.

## Лицензия

MIT
